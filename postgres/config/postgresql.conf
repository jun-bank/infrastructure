# =============================================================================
# Jun Bank PostgreSQL Configuration
# pgvector 최적화 및 성능 튜닝 설정
# =============================================================================

# -----------------------------------------------------------------------------
# Connection Settings
# -----------------------------------------------------------------------------
listen_addresses = '*'
port = 5432
max_connections = 200

# -----------------------------------------------------------------------------
# Memory Settings
# -----------------------------------------------------------------------------
# shared_buffers: 전체 RAM의 25% 권장 (컨테이너 기준 조정)
shared_buffers = 256MB

# effective_cache_size: 전체 RAM의 50-75% 권장
effective_cache_size = 768MB

# work_mem: 복잡한 쿼리 정렬/해시에 사용
work_mem = 16MB

# maintenance_work_mem: VACUUM, CREATE INDEX 등에 사용
maintenance_work_mem = 128MB

# -----------------------------------------------------------------------------
# WAL (Write-Ahead Logging) Settings
# -----------------------------------------------------------------------------
wal_level = replica
max_wal_size = 1GB
min_wal_size = 80MB
checkpoint_completion_target = 0.9

# -----------------------------------------------------------------------------
# Query Planner Settings
# -----------------------------------------------------------------------------
random_page_cost = 1.1
effective_io_concurrency = 200
default_statistics_target = 100

# -----------------------------------------------------------------------------
# Parallel Query Settings
# -----------------------------------------------------------------------------
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2

# -----------------------------------------------------------------------------
# pgvector Settings
# -----------------------------------------------------------------------------
# pgvector 인덱스 빌드 시 메모리
maintenance_work_mem = 128MB

# IVFFlat 인덱스 프로브 수 (검색 정확도 vs 속도)
# SET ivfflat.probes = 10; (쿼리에서 설정)

# HNSW 인덱스 설정
# SET hnsw.ef_search = 100; (쿼리에서 설정)

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_statement = 'ddl'

# -----------------------------------------------------------------------------
# Locale Settings
# -----------------------------------------------------------------------------
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'

# -----------------------------------------------------------------------------
# Timezone
# -----------------------------------------------------------------------------
timezone = 'Asia/Seoul'